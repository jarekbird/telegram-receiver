# PHASE3-022: Review file/folder structure

**Section**: 4. Code Organization
**Subsection**: 4.1
**Task ID**: PHASE3-022

## Description

Review and improve the file/folder structure in the codebase to ensure best practices and alignment with the architecture documentation. This task focuses on validating the directory organization, identifying missing directories, checking naming conventions, and ensuring the structure supports the application's requirements.

## Checklist

### Directory Structure Review

- [ ] Verify all directories mentioned in `docs/architecture.md` exist in `src/`
  - [ ] `src/config/` - Configuration files
  - [ ] `src/controllers/` - Request/response handlers
  - [ ] `src/middleware/` - Express middleware
  - [ ] `src/models/` - Data models
  - [ ] `src/routes/` - Route definitions
  - [ ] `src/services/` - Business logic services
  - [ ] `src/types/` - TypeScript type definitions
  - [ ] `src/utils/` - Utility functions
  - [x] `src/jobs/` - Background job processors (BullMQ jobs) - ✅ Created
  - [x] `src/errors/` - Custom error classes - ✅ Created
  - [x] `src/validators/` - Request validation schemas/functions - ✅ Created

### File Naming Conventions

- [ ] Verify TypeScript files use `.ts` extension
- [ ] Verify test files follow naming pattern: `*.test.ts` or `*.spec.ts`
- [ ] Check that file names use kebab-case or camelCase consistently
- [ ] Verify index files are named `index.ts` where appropriate
- [ ] Check that configuration files follow standard naming (`.eslintrc.json`, `.prettierrc.json`, etc.)

### Directory Organization

- [ ] Verify empty directories use `.gitkeep` files appropriately
- [ ] Check for misplaced files (e.g., source files in root, config files in wrong locations)
- [ ] Verify test directory structure mirrors `src/` structure
- [ ] Check that `tests/` has proper organization:
  - [ ] `tests/unit/` mirrors `src/` structure
  - [ ] `tests/integration/` has appropriate subdirectories
  - [ ] `tests/e2e/` exists for end-to-end tests
  - [ ] `tests/fixtures/` contains test data
  - [ ] `tests/mocks/` contains mock implementations
  - [ ] `tests/helpers/` contains test utilities

### Missing Components

- [x] Create `src/jobs/` directory for BullMQ job processors (as mentioned in architecture.md) - ✅ Completed
- [x] Create `src/errors/` directory for custom error classes (TelegramApiError, CursorRunnerApiError, etc.) - ✅ Completed
- [x] Create `src/validators/` directory for request validation schemas/functions - ✅ Completed
- [x] Verify each directory has appropriate `.gitkeep` file if empty - ✅ Verified

### Module Organization

- [ ] Verify separation of concerns between layers (routes → controllers → services → models)
- [ ] Check that middleware is properly organized in `src/middleware/`
- [ ] Verify services are organized logically (consider subdirectories for related services)
- [ ] Check that types are properly organized and exported from `src/types/`

### Structural Improvements

- [ ] Document any structural improvements needed
- [ ] Identify any directories that should be created
- [ ] Identify any directories that should be removed or consolidated
- [ ] Check for consistency with Node.js/TypeScript best practices
- [ ] Verify alignment with Express.js conventions

### Documentation

- [ ] Update `docs/architecture.md` if structure changes are made
- [ ] Document any deviations from standard patterns and rationale
- [ ] Ensure directory structure is documented clearly

## Notes

- This task is part of Phase 3: Holistic Review and Best Practices
- Section: 4. Code Organization
- Focus on identifying issues and improvements
- Document findings and decisions

- Task can be completed independently by a single agent

## Evaluation Findings

### Current Structure Status

**Existing Directories:**

- ✅ `src/config/` - Exists (empty, has .gitkeep)
- ✅ `src/controllers/` - Exists (empty, has .gitkeep)
- ✅ `src/middleware/` - Exists (empty, has .gitkeep)
- ✅ `src/models/` - Exists (empty, has .gitkeep)
- ✅ `src/routes/` - Exists (empty, has .gitkeep)
- ✅ `src/services/` - Exists (empty, has .gitkeep)
- ✅ `src/types/` - Exists (empty, has .gitkeep)
- ✅ `src/utils/` - Exists (empty, has .gitkeep)
- ✅ `src/jobs/` - Created (empty, has .gitkeep)
- ✅ `src/errors/` - Created (empty, has .gitkeep)
- ✅ `src/validators/` - Created (empty, has .gitkeep)

**Previously Missing Directories (now created):**

- ✅ `src/jobs/` - Created (needed for BullMQ job processors) - **COMPLETED**
- ✅ `src/errors/` - Created (needed for custom error classes like TelegramApiError) - **COMPLETED**
- ✅ `src/validators/` - Created (needed for request validation) - **COMPLETED**

**Test Structure:**

- ✅ Well-organized with `unit/`, `integration/`, `e2e/`, `fixtures/`, `mocks/`, `helpers/`
- ✅ Test directory structure mirrors `src/` structure appropriately

**Configuration Files:**

- ✅ Properly organized in root directory
- ✅ Standard naming conventions followed (.eslintrc.json, .prettierrc.json, tsconfig.json)

### Recommendations

1. **Create Missing Directories**: ✅ **COMPLETED** - Added `src/jobs/`, `src/errors/`, and `src/validators/` directories with .gitkeep files
2. **Verify Architecture Alignment**: ✅ **VERIFIED** - All directories mentioned in `docs/architecture.md` are now created
3. **Naming Consistency**: Verify file naming follows kebab-case or camelCase consistently (to be checked when files are added)
4. **Documentation**: ✅ **VERIFIED** - architecture.md already documents the required structure; no updates needed

### Validation Summary

**Task Validation Status**: ✅ **VALIDATED AND COMPLETED**

- Task description accurately describes the review requirements
- All referenced directories in architecture.md have been verified
- Missing directories identified in the task have been created
- Directory structure now matches architecture documentation
- All directories have appropriate .gitkeep files
- Test structure is properly organized
- Configuration files follow standard naming conventions

**Actions Taken**:

- Created `src/jobs/` directory with .gitkeep file
- Created `src/errors/` directory with .gitkeep file
- Created `src/validators/` directory with .gitkeep file
- Verified all directories match architecture.md requirements

## Related Tasks

- Previous: PHASE3-021
- Next: PHASE3-023

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

