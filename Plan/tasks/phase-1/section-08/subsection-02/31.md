# PHASE1-031: Create logger configuration module

**Section**: 8. Logging Infrastructure
**Subsection**: 8.2
**Task ID**: PHASE1-031

## Description

Create logger configuration module that replicates Rails logging patterns from jarek-va. The module must configure log levels, formats, and transports based on environment variables, matching the Rails application's logging behavior.

**Rails Logging Patterns to Replicate:**

- Production: Log level `:info` (see `jarek-va/config/environments/production.rb` line 40)
- Production: Log formatter using `Logger::Formatter.new` (includes timestamp and log level, see `jarek-va/config/environments/production.rb` line 60)
- Production: Request ID tagging via `config.log_tags = [:request_id]` and `ActiveSupport::TaggedLogging` wrapper (see `jarek-va/config/environments/production.rb` line 43 and line 69)
- Production: Conditional stdout logging when `RAILS_LOG_TO_STDOUT` environment variable is set (wraps stdout logger with `ActiveSupport::TaggedLogging`, see `jarek-va/config/environments/production.rb` lines 66-69). Note: In Docker/production deployments, `RAILS_LOG_TO_STDOUT=true` is typically always set (see `jarek-va/docker-compose.yml` and `jarek-va/Dockerfile`)
- Application: `LOG_LEVEL` environment variable support (defaults to 'info', applies to all environments unless overridden, see `jarek-va/config/application.rb` line 28)
- Error logging: Full stack traces - logs exception class/message and full backtrace as separate log entries (see `jarek-va/app/controllers/application_controller.rb` lines 10-11)
- Sidekiq: Logger::INFO level (see `jarek-va/config/initializers/sidekiq.rb` line 31)

## Checklist

- [ ] Create `src/config/logger.ts` file
- [ ] Import logging library chosen in PHASE1-030 (winston or pino)
- [ ] Create logger instance with proper configuration
- [ ] Configure log levels based on NODE_ENV and LOG_LEVEL environment variable:
  - [ ] Production: 'info' level (or value from LOG_LEVEL env var)
  - [ ] Development: 'debug' level (or value from LOG_LEVEL env var)
  - [ ] Test: 'error' level (or value from LOG_LEVEL env var)
  - [ ] Default: 'info' if LOG_LEVEL not set
- [ ] Configure log format:
  - [ ] Production: JSON format (structured logging for log aggregation, matches Rails `Logger::Formatter.new` behavior)
  - [ ] Development: Pretty/human-readable format
  - [ ] Test: JSON format (for test consistency)
  - [ ] Ensure formatter includes timestamp and log level (matching Rails Logger::Formatter behavior)
- [ ] Configure log transports:
  - [ ] Console transport (stdout for production, supports Docker logging)
  - [ ] Ensure stdout logging for production (matches Rails `RAILS_LOG_TO_STDOUT` behavior)
  - [ ] File transport optional (only if needed for local development)
- [ ] Configure request ID support (for production request tracing, matches Rails `config.log_tags = [:request_id]` and `ActiveSupport::TaggedLogging` wrapper behavior)
  - [ ] Support creating child loggers with request ID context (similar to Rails TaggedLogging)
  - [ ] Ensure request IDs are included in log output when available
- [ ] Ensure error logging includes stack traces (matches Rails error logging pattern)
- [ ] Export configured logger instance

## Notes

- This task is part of Phase 1: Basic Node.js API Infrastructure
- Section: 8. Logging Infrastructure
- Task can be completed independently by a single agent
- **Prerequisite**: PHASE1-030 must be completed first to determine which logging library (winston or pino) to use
- **Rails Reference**: The jarek-va Rails application logging configuration:
  - `jarek-va/config/application.rb` (line 28) - LOG_LEVEL environment variable support (applies to all environments, defaults to 'info')
  - `jarek-va/config/environments/production.rb` (line 40) - Production log level set to `:info`
  - `jarek-va/config/environments/production.rb` (line 43) - Request ID tagging via `config.log_tags = [:request_id]`
  - `jarek-va/config/environments/production.rb` (line 60) - Log formatter using `Logger::Formatter.new` (includes timestamp and log level)
  - `jarek-va/config/environments/production.rb` (lines 66-69) - Stdout logging with `ActiveSupport::TaggedLogging` wrapper when `RAILS_LOG_TO_STDOUT` is set
  - `jarek-va/app/controllers/application_controller.rb` (lines 10-11) - Error logging with full backtraces
  - `jarek-va/config/initializers/sidekiq.rb` (line 31) - Sidekiq logging level set to `Logger::INFO`
- **Environment Variables**:
  - `NODE_ENV`: Determines environment (production, development, test)
  - `LOG_LEVEL`: Overrides default log level for the current environment (info, debug, warn, error)
  - **Note**: Rails uses a single `LOG_LEVEL` that applies to all environments (defaults to 'info'). This Node.js implementation uses environment-specific defaults (debug for dev, error for test, info for production) which is more conventional for Node.js applications, while still allowing `LOG_LEVEL` to override.
- **Production Requirements**: Must support stdout logging for Docker/containerized environments (matches Rails `RAILS_LOG_TO_STDOUT` behavior). In production, the logger should output to stdout (similar to how Rails wraps the logger with `ActiveSupport::TaggedLogging` when `RAILS_LOG_TO_STDOUT` is present). Since this is a Node.js application typically deployed in containers, stdout logging should be the default for production to match the Rails Docker deployment pattern.
- **Request ID Support**: The logger should support adding request IDs to log entries (via child loggers or context) to match Rails' `config.log_tags = [:request_id]` and `ActiveSupport::TaggedLogging` wrapper behavior. This will be used by PHASE1-020 (request logging middleware). The implementation should allow creating child loggers with request ID context that automatically includes the request ID in all log entries.
- **Log Formatter**: The logger formatter should include timestamp and log level information, matching Rails' `Logger::Formatter.new` behavior. In production, this should be structured JSON format for log aggregation tools.

## Related Tasks

- Previous: PHASE1-030 (Choose logging library - must be completed first)
- Next: PHASE1-032 (Create logger utility wrapper)

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

