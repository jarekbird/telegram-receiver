# PHASE1-035: Integrate logger in error handler

**Section**: 8. Logging Infrastructure
**Subsection**: 8.6
**Task ID**: PHASE1-035

## Description

Integrate logger utility in the error handler middleware (`src/middleware/error-handler.middleware.ts`) to replace `console.error()` statements with proper logging using the logger utility wrapper created in PHASE1-032. This task ensures that error logging uses the configured logger instead of console methods, matching Rails error logging patterns from jarek-va's `ApplicationController`.

**Rails Error Logging Patterns to Replicate:**

- The jarek-va Rails application uses `Rails.logger.error()` for error logging in `ApplicationController` (see `jarek-va/app/controllers/application_controller.rb` lines 10-11)
- Errors are logged in two separate calls:
  1. Error class and message: `Rails.logger.error("#{exception.class}: #{exception.message}")`
  2. Stack trace: `Rails.logger.error(exception.backtrace.join("\n"))`
- This pattern ensures error class, message, and stack trace are all logged for debugging

**Purpose:**

- Replace `console.error()` with proper logger methods for consistent logging across the application
- Ensure error logging uses the configured logger (matching Rails error logging patterns)
- Enable structured logging for error events (useful for log aggregation in production)
- Match Rails error logging pattern where error class/message and stack trace are logged separately

## Checklist

- [ ] Open `src/middleware/error-handler.middleware.ts` (created in PHASE1-021)
- [ ] Import logger utility from `@/utils/logger` (created in PHASE1-032)
- [ ] Replace `console.error()` calls with `logger.error()` for error logging:
  - [ ] Replace error class and message logging with `logger.error()` (matching Rails pattern: `Rails.logger.error("#{exception.class}: #{exception.message}")`)
  - [ ] Replace stack trace logging with `logger.error()` (matching Rails pattern: `Rails.logger.error(exception.backtrace.join("\n"))`)
- [ ] Ensure error logging matches Rails pattern:
  - [ ] Log error class name: `err.constructor.name` (preferred, matches Rails `exception.class`) or `err.name` as fallback
  - [ ] Log error message: `err.message`
  - [ ] Log stack trace: `err.stack` (as separate log call, matching Rails pattern where `exception.backtrace.join("\n")` is logged separately)
- [ ] Verify all `console.error()` statements are replaced with logger methods
- [ ] Ensure logging format is consistent with the logger configuration (from PHASE1-031)

## Notes

- This task is part of Phase 1: Basic Node.js API Infrastructure
- Section: 8. Logging Infrastructure
- Task can be completed independently by a single agent
- **Prerequisite**: PHASE1-032 must be completed first to create the logger utility wrapper
- **Prerequisite**: PHASE1-021 must be completed first to create the error handler middleware (`src/middleware/error-handler.middleware.ts`)
- **Rails Reference**: The jarek-va Rails application uses `Rails.logger.error()` for error logging in `ApplicationController`:
  - `jarek-va/app/controllers/application_controller.rb` (lines 10-11) - Error logging with error class/message and separate stack trace logging
  - Errors are logged in two separate calls: first the error class and message, then the backtrace
- **Error Logging**: The `src/middleware/error-handler.middleware.ts` file (created in PHASE1-021) should already have error logging code using `console.error()`. This task replaces those console statements with logger methods.
- **Rails Logging Pattern**: Match the Rails pattern where error class/message and stack trace are logged separately:

  ```typescript
  // Before (from PHASE1-021):
  console.error(`Error: ${err.name}: ${err.message}`);
  console.error(err.stack);

  // After (this task):
  import logger from '@/utils/logger';
  // Match Rails pattern: Rails.logger.error("#{exception.class}: #{exception.message}")
  logger.error(`${err.constructor.name}: ${err.message}`);
  // Match Rails pattern: Rails.logger.error(exception.backtrace.join("\n"))
  logger.error(err.stack);
  ```

- **Error Object Handling**: The logger utility (from PHASE1-032) should handle Error objects and include stack traces automatically, but the error handler should still log them explicitly to match Rails pattern.

## Related Tasks

- Previous: PHASE1-034
- Next: PHASE1-036

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

