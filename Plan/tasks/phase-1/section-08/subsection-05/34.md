# PHASE1-034: Integrate logger in middleware

**Section**: 8. Logging Infrastructure
**Subsection**: 8.5
**Task ID**: PHASE1-034

## Description

Integrate logger utility in the request logging middleware (`src/middleware/request-logger.middleware.ts`) to replace console.log statements with proper logging using the logger utility wrapper created in PHASE1-032. This task ensures that request/response logging uses the configured logger instead of console methods, matching Rails logging patterns from jarek-va with request_id tagging.

**Rails Logging Patterns to Replicate:**

- The jarek-va Rails application uses `config.log_tags = [:request_id]` in production (see `jarek-va/config/environments/production.rb` line 43), which prepends request_id to all log lines
- Rails' built-in request logging middleware (`ActionDispatch::RequestId` and `Rack::Logger`) automatically logs incoming requests with method, path, IP, and request_id
- Request logging uses `Rails.logger.info()` for normal request/response logging
- The request_id is included in all log entries for request tracing (see `jarek-va/config/environments/production.rb` line 69: `ActiveSupport::TaggedLogging` wrapper)
- Rails automatically generates a unique request ID for each request and includes it in all log entries via the `TaggedLogging` wrapper

**Purpose:**

- Replace console.log with proper logger methods for consistent logging across the application
- Ensure request/response logging uses the configured logger (matching Rails logging patterns with request_id tagging)
- Enable structured logging for request/response events (useful for log aggregation in production)
- Maintain request_id context in logs for request tracing (matching Rails `config.log_tags = [:request_id]` behavior)

## Checklist

- [ ] Open `src/middleware/request-logger.middleware.ts` (created in PHASE1-020)
- [ ] Import logger utility from `@/utils/logger` (created in PHASE1-032)
- [ ] Replace `console.log()` calls with `logger.info()` for request logging:
  - [ ] Replace request logging (method, URL, IP, request ID, timestamp) with `logger.info()`
  - [ ] Replace response logging (status code, duration, request ID) with `logger.info()`
- [ ] Ensure request_id is included in log messages (for request tracing, matching Rails `config.log_tags = [:request_id]` behavior)
- [ ] Use structured logging format that includes request_id (matching Rails TaggedLogging behavior)
- [ ] Verify all console.log statements are replaced with logger methods
- [ ] Ensure logging format is consistent with the logger configuration (from PHASE1-031)

## Notes

- This task is part of Phase 1: Basic Node.js API Infrastructure
- Section: 8. Logging Infrastructure
- Task can be completed independently by a single agent
- **Prerequisite**: PHASE1-032 must be completed first to create the logger utility wrapper
- **Prerequisite**: PHASE1-020 must be completed first to create the request logging middleware (`src/middleware/request-logger.middleware.ts`)
- **Rails Reference**: The jarek-va Rails application uses request_id tagging for request tracing:
  - `jarek-va/config/environments/production.rb` (line 43) - Request ID tagging via `config.log_tags = [:request_id]`
  - `jarek-va/config/environments/production.rb` (line 69) - `ActiveSupport::TaggedLogging` wrapper that prepends request_id to all log lines
  - Rails automatically logs requests with request_id included in log output
- **Request Logging**: The `src/middleware/request-logger.middleware.ts` file (created in PHASE1-020) should already have request/response logging code using `console.log()`. This task replaces those console statements with logger methods.
- **Request ID Context**: The middleware should log request_id in all log messages to enable request tracing, matching Rails' `config.log_tags = [:request_id]` behavior. The logger utility (from PHASE1-032) should support request_id context if needed.
- **Usage Pattern**: Replace console statements like:

  ```typescript
  // Before (from PHASE1-020):
  console.log(`[${requestId}] ${method} ${url} - ${ip}`);
  console.log(`[${requestId}] ${statusCode} ${duration}ms`);

  // After (this task):
  import logger from '@/utils/logger';
  logger.info(`[${requestId}] ${method} ${url} - ${ip}`);
  logger.info(`[${requestId}] ${statusCode} ${duration}ms`);
  ```

- **Structured Logging**: Consider logging in a structured format (JSON) that includes request_id, matching Rails TaggedLogging behavior where request_id is prepended to all log lines.

## Related Tasks

- Previous: PHASE1-033
- Next: PHASE1-035

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

