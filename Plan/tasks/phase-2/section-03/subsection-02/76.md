# PHASE2-013: Create async processing configuration

**Section**: 3. Async Processing Setup
**Subsection**: 3.2
**Task ID**: PHASE2-013

## Description

Create async processing configuration for TypeScript/Node.js. Since this application doesn't have regularly scheduled jobs, we will leverage Node.js's asynchronous nature instead of using a queue system like BullMQ or Sidekiq. This task creates the configuration file that sets up async processing patterns, error handling, and environment-specific settings.

**Rails Implementation Reference:**

- `jarek-va/config/initializers/sidekiq.rb` - Sidekiq initialization with Redis connection, default job options, and logging configuration
- `jarek-va/config/sidekiq.yml` - Environment-specific queue names and concurrency settings
- `jarek-va/config/application.rb` - ActiveJob adapter configuration (line 31: `config.active_job.queue_adapter = :sidekiq`)

**Node.js Implementation:**

- Create `src/config/async.ts` to configure async processing patterns
- Set default async processing options (retry logic, error handling)
- Export async processing configuration for use by async handlers
- Support environment-specific configuration (development, test, production)
- Configure concurrency limits and timeout settings for async operations

## Checklist

- [ ] Create `src/config/async.ts` file
- [ ] Configure default async processing options:
  - [ ] Configure default retry attempts (3 retries to match Rails behavior)
  - [ ] Configure retry delay strategy (exponential backoff)
  - [ ] Configure timeout settings for async operations
  - [ ] Export default async processing options for use by async handlers
- [ ] Configure environment-specific settings:
  - [ ] Development: concurrency limit 2, timeout 30s
  - [ ] Test: concurrency limit 1, timeout 10s
  - [ ] Production: concurrency limit 10, timeout 60s
  - [ ] Load settings based on `NODE_ENV` environment variable
- [ ] Configure error handling:
  - [ ] Set up error logging with full stack traces (matching Rails `backtrace: true`)
  - [ ] Configure error handling patterns for async operations
  - [ ] Export error handling utilities
- [ ] Configure logging:
  - [ ] Set appropriate log level (INFO level, matching Rails `Logger::INFO`)
  - [ ] Ensure async operations are logged appropriately
- [ ] Export configuration:
  - [ ] Export default async processing options
  - [ ] Export environment-specific async configuration
  - [ ] Export helper functions for async operations with proper configuration
  - [ ] Export retry utilities with exponential backoff
- [ ] Add TypeScript types for async processing configuration

## Notes

- This task is part of Phase 2: File-by-File Conversion
- Section: 3. Async Processing Setup
- **Rails Files to Reference:**
  - `jarek-va/config/initializers/sidekiq.rb` - Main Sidekiq configuration:
    - Default job options: `retry: 3, backtrace: true`
    - Logging level: `Logger::INFO`
    - Loads `sidekiq.yml` for concurrency settings
  - `jarek-va/config/sidekiq.yml` - Environment-specific configuration:
    - Default (top-level): concurrency 5, queues: `['default', 'high_priority', 'low_priority']` (used as fallback)
    - Development: concurrency 2, queues: `['default']`
    - Test: concurrency 1, queues: `['default']`
    - Production: concurrency 10, queues: `['critical', 'default', 'high_priority', 'low_priority']`
  - `jarek-va/config/application.rb` - ActiveJob adapter set to `:sidekiq` (line 31)
- **Dependencies:**
  - No external queue dependencies required (using Node.js native async)
  - Uses `NODE_ENV` environment variable for environment-specific settings
- **Implementation Details:**
  - Since this application doesn't have regularly scheduled jobs, we use Node.js's asynchronous nature instead of a queue system
  - Async operations will use `Promise`-based patterns with proper error handling
  - Retry logic should be implemented using exponential backoff (similar to Sidekiq's `wait: :exponentially_longer`)
  - Default retry attempts: 3 (matching Rails `retry: 3`)
  - Error logging should include full stack traces (matching Rails `backtrace: true`)
  - Concurrency limits can be managed using `Promise.all()` with batching or semaphore patterns
  - Environment-specific settings should be loaded based on `NODE_ENV`
  - Consider creating helper functions like `withRetry<T>(fn: () => Promise<T>, options?: RetryOptions): Promise<T>` that apply default retry logic
  - Consider creating helper functions like `withTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T>` for timeout handling
- **Key Differences from Rails:**
  - Rails: Uses Sidekiq for background job processing with Redis queues
  - Node.js: Uses native async/await with Promise-based patterns (no queue system needed)
  - Rails: Queue names and concurrency are in `sidekiq.yml` file
  - Node.js: Concurrency is managed via configuration and Promise patterns
  - Rails: Default job options are set globally via `Sidekiq.default_job_options`
  - Node.js: Default async options should be applied via helper functions
- **Testing Considerations:**
  - Test that default async options are applied
  - Test environment-specific configuration loading
  - Test that configuration exports are available for import
  - Test retry logic with exponential backoff
  - Test timeout handling
- Task can be completed independently by a single agent

## Related Tasks

- Previous: PHASE2-012
- Next: PHASE2-014

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

