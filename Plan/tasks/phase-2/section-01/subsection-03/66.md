# PHASE2-003: Create ElevenLabs API types

**Section**: 1. TypeScript Type Definitions
**Subsection**: 1.3
**Task ID**: PHASE2-003

## Description

Create TypeScript type definitions for ElevenLabs API. These types will be used for speech-to-text and text-to-speech operations. The types must accurately reflect the API request/response structures used in the Rails services.

## Checklist

- [ ] Create `src/types/elevenlabs.ts` file
- [ ] Define `ElevenLabsTranscribeRequest` interface for STT requests
  - [ ] Include `file` field (Buffer or Readable stream for multipart/form-data in Node.js)
  - [ ] Include `filename` field (string, optional - filename for the audio file in multipart form)
  - [ ] Include `model_id` field (string, default: 'scribe_v1')
  - [ ] Include optional `language` field (string, e.g., 'en', 'es', 'fr')
- [ ] Define `ElevenLabsTranscribeResponse` interface for STT responses
  - [ ] Include `text` field (string, required - the transcribed text)
- [ ] Define `ElevenLabsSynthesizeRequest` interface for TTS requests
  - [ ] Include `text` field (string, required)
  - [ ] Include `model_id` field (string, default: 'eleven_turbo_v2_5')
  - [ ] Include `output_format` field (string, default: 'mp3_44100_128')
  - [ ] Include optional `voice_settings` field (ElevenLabsVoiceSettings)
- [ ] Define `ElevenLabsSynthesizeResponse` type for TTS responses
  - [ ] Note: TTS returns binary audio data (Buffer), not JSON
  - [ ] Type should be `Buffer` or `ArrayBuffer` for audio/mpeg content
- [ ] Define `ElevenLabsVoiceSettings` interface for voice configuration
  - [ ] Include optional `stability` field (number, typically 0-1)
  - [ ] Include optional `similarity_boost` field (number, typically 0-1)
  - [ ] Include other voice settings as needed (style, use_speaker_boost, etc.)
- [ ] Define `ElevenLabsErrorResponse` interface for API error responses
  - [ ] Support error responses that can be objects or arrays (TTS handles both, STT typically returns objects)
  - [ ] For array format: `Array<{msg?: string}>` (array of objects with optional `msg` field)
  - [ ] For object format: Include `detail` field (string | string[] | Array<{msg?: string}>)
  - [ ] Include optional `error` field (string)
  - [ ] Include optional `message` field (string)
  - [ ] Note: When `detail` is an array, extract `msg` fields from each item
- [ ] Define error classes matching Rails service errors (extend Error class)
  - [ ] `ElevenLabsError` (base error class extending Error)
  - [ ] `ElevenLabsConnectionError` (extends ElevenLabsError)
  - [ ] `ElevenLabsTimeoutError` (extends ElevenLabsError)
  - [ ] `ElevenLabsInvalidResponseError` (extends ElevenLabsError)
  - [ ] `ElevenLabsTranscriptionError` (extends ElevenLabsError, for STT)
  - [ ] `ElevenLabsSynthesisError` (extends ElevenLabsError, for TTS)
- [ ] Export all types and interfaces

## Notes

- This task is part of Phase 2: File-by-File Conversion
- Section: 1. TypeScript Type Definitions
- Reference `jarek-va/app/services/eleven_labs_speech_to_text_service.rb` and `eleven_labs_text_to_speech_service.rb`
- Types should match the ElevenLabs API structure as implemented in the Rails services

### Implementation Details from Rails Services

**Speech-to-Text (STT) Service:**

- Uses `multipart/form-data` format (not JSON)
- Request fields: `file` (audio file content as binary), `model_id` (string), `language` (optional string)
- In Rails: Uses `File.binread()` or `IO.read()` to get file content, includes filename in multipart form
- Response is JSON with `text` field containing transcribed text
- Default model_id: `'scribe_v1'`
- Endpoint: `/v1/speech-to-text`
- Error responses are typically objects (not arrays) with `detail`, `error`, or `message` fields

**Text-to-Speech (TTS) Service:**

- Uses JSON format for request body
- Request fields: `text` (required), `model_id` (string), `output_format` (string), `voice_settings` (optional object)
- Response is binary audio data (`audio/mpeg`), NOT JSON
- Default model_id: `'eleven_turbo_v2_5'`
- Default output_format: `'mp3_44100_128'`
- Default voice_id: `'vfaqCOvlrKi4Zp7C2IAm'` (used in URL path, not request body)
- Endpoint: `/v1/text-to-speech/{voice_id}`
- Error responses can be arrays or objects:
  - Array format: `[{msg: string}, ...]`
  - Object format: `{detail: string | string[] | Array<{msg?: string}>, error?: string, message?: string}`
  - When detail is an array, extract `msg` fields from each item

**Voice Settings:**

- Optional hash/object passed to TTS requests
- Common fields: `stability`, `similarity_boost` (based on service comments)
- Should be flexible to accommodate other ElevenLabs voice settings

**Error Handling:**

- Both services define custom error classes inheriting from base Error
- Connection errors, timeout errors, invalid response errors, and operation-specific errors
- STT error parsing handles JSON object responses (with `detail`, `error`, or `message` fields)
- TTS error parsing handles both JSON object and array responses (arrays have `msg` fields, objects can have `detail` as array)
- Task can be completed independently by a single agent

## Related Tasks

- Previous: PHASE2-002
- Next: PHASE2-004

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

