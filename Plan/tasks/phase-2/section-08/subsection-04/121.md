# PHASE2-058: Implement set_webhook endpoint

**Section**: 8. TelegramController Conversion
**Subsection**: 8.4
**Task ID**: PHASE2-058

## Description

Convert the `set_webhook` endpoint from Rails to TypeScript/Node.js. This endpoint allows administrators to set the Telegram webhook URL and optional secret token.

**Rails Implementation**: `jarek-va/app/controllers/telegram_controller.rb` (lines 51-70)

**Route**: `POST /telegram/set_webhook`

**Key Functionality**:

- Requires admin authentication via `authenticate_admin` method (checks `X-Admin-Secret` header, `HTTP_X_ADMIN_SECRET` env var, or `admin_secret` param)
- Admin authentication compares against `webhook_secret` config value (not `telegram_webhook_secret`)
- Accepts optional `url` parameter (defaults to constructed webhook URL if not provided)
- Accepts optional `secret_token` parameter (defaults to `telegram_webhook_secret` config value if not provided)
- Calls `TelegramService.set_webhook(url: webhook_url, secret_token: secret_token)` to set the webhook via Telegram Bot API
- Returns JSON response with success status, message, and webhook info
- Handles errors and returns appropriate error responses

**Default Webhook URL Construction**:

- Uses `telegram_webhook_base_url` config or `TELEGRAM_WEBHOOK_BASE_URL` env var
- Defaults to `http://localhost:3000` if not set
- Appends `/telegram/webhook` to base URL

## Checklist

- [ ] Implement `setWebhook` handler method
- [ ] Require admin authentication (check `X-Admin-Secret` header, `HTTP_X_ADMIN_SECRET` env var, or `admin_secret` param against `webhook_secret` config)
- [ ] Get webhook URL from request params or use default (construct from `telegram_webhook_base_url` config or `TELEGRAM_WEBHOOK_BASE_URL` env var + `/telegram/webhook`, defaulting to `http://localhost:3000/telegram/webhook`)
- [ ] Get secret_token from request params or use `telegram_webhook_secret` config default
- [ ] Call `TelegramService.setWebhook(url, secretToken)` with both parameters (adapt Rails keyword arguments to TypeScript/Node.js style)
- [ ] Return JSON success response with format: `{ ok: true, message: 'Webhook set successfully', webhook_info: result }`
- [ ] Handle errors and return JSON error response: `{ ok: false, error: errorMessage }` with 500 status
- [ ] Return 401 Unauthorized if admin authentication fails

## Notes

- This task is part of Phase 2: File-by-File Conversion
- Section: 8. TelegramController Conversion
- Reference the Rails implementation for behavior

- Task can be completed independently by a single agent

## Related Tasks

- Previous: PHASE2-057
- Next: PHASE2-059

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

