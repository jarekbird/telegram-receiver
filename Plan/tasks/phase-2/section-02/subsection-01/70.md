# PHASE2-007: Install Redis client dependencies

**Section**: 2. Redis Integration
**Subsection**: 2.1
**Task ID**: PHASE2-007

## Description

Verify and ensure Redis client dependencies are properly installed for TypeScript/Node.js conversion. The Rails application uses Redis for:

1. **CursorRunnerCallbackService** (`app/services/cursor_runner_callback_service.rb`) - Stores callback state using direct Redis operations (`setex`, `get`, `del`)
2. **Sidekiq** (`config/initializers/sidekiq.rb`) - Background job processing (Note: We're using Node.js native async instead of a queue system)

**Rails Implementation Reference:**

- Rails uses `redis` gem version `~> 5.0` (see `jarek-va/Gemfile`)
- Redis connection configured via `REDIS_URL` environment variable (default: `redis://localhost:6379/0`)
- In Docker: `REDIS_URL=redis://redis:6379/0` (shared Redis instance)

**Node.js Implementation:**

- Both `redis` (^4.6.10) and `ioredis` (^5.3.2) are already in `package.json`
- **Note**: `bullmq` may be in `package.json` but is NOT needed for this application (we use Node.js native async instead of a queue system)
- **redis** or **ioredis** package can be used for direct Redis operations (matching CursorRunnerCallbackService pattern)
- Both packages have TypeScript type definitions (`@types/redis` and `@types/ioredis`)

## Checklist

- [x] Verify `redis` package is installed (check `package.json` and `node_modules`)
- [x] Verify `ioredis` package is installed (check `package.json` and `node_modules`)
- [x] Note: `bullmq` is NOT needed for this application (we use Node.js native async instead of a queue system)
- [x] Verify `@types/redis` is installed in devDependencies
- [x] Verify `@types/ioredis` is installed in devDependencies
- [x] Run `npm install` to ensure all dependencies are properly installed
- [x] Verify Redis connection configuration matches Rails pattern (REDIS_URL environment variable)
- [x] Document which Redis client will be used for each component:
  - [x] `redis` or `ioredis` for CursorRunnerCallbackService (direct Redis operations)
  - [x] Note: No queue system needed - we use Node.js native async/await
- [x] Test basic Redis connectivity (optional: create simple connection test)

## Completion Status

âœ… **Task Completed**: All Redis client dependencies verified and properly installed.

**Verification Summary**:

- All required packages (`redis`, `ioredis`) are installed and verified
- Note: `bullmq` is not needed (we use Node.js native async instead of a queue system)
- Type definitions are available (packages include built-in types)
- Redis connection configuration matches Rails pattern (`REDIS_URL` environment variable)
- Documentation exists in `docs/REDIS_CLIENT_USAGE.md`
- Redis connection test exists at `tests/unit/redis-connection.test.ts`

See `docs/PHASE2-007-COMPLETION.md` for detailed verification results.

## Notes

- This task is part of Phase 2: File-by-File Conversion
- Section: 2. Redis Integration
- **Current Status**: Redis dependencies (`redis`, `ioredis`) are present in `package.json` (note: `bullmq` is not needed)
- This task focuses on verification and ensuring proper setup rather than initial installation
- Reference the Rails implementation in `jarek-va/app/services/cursor_runner_callback_service.rb` for Redis usage patterns
- Note: We use Node.js native async instead of a queue system, so Sidekiq/BullMQ patterns are not applicable
- Task can be completed independently by a single agent

## Related Tasks

- Previous: PHASE2-006
- Next: PHASE2-008

## Definition of Done

This document defines the criteria for task completion. The review agent uses these definitions to evaluate whether a task has been completed successfully.

### 1. CODE/FILE WRITING TASKS

**Description**: Tasks that involve writing, creating, modifying, or implementing SOURCE CODE FILES that need to be committed to git.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Examples**:
- Creating new source code files
- Modifying existing source code files
- Implementing features, functions, classes, modules
- Writing tests, specs
- Refactoring code
- Fixing bugs in source code

### 2. SYSTEM/ENVIRONMENT OPERATION TASKS

**Description**: Tasks involving installing dependencies, running builds, installing packages, running migrations, executing install scripts, etc.

**Definition of Done**: "The required operation must complete successfully with no errors, and the expected artifacts must be created. If any part of the operation fails, the task is NOT complete."

**Important Notes**:
- Installing dependencies requires packages to actually be installed successfully
- Updating package.json is NOT enough
- If the output mentions environmental issues, errors, warnings, or failed operations, the task is NOT complete

**Examples**:
- Installing npm packages, pip packages, gem dependencies
- Running database migrations
- Building/compiling projects
- Setting up development environments
- Running install scripts

